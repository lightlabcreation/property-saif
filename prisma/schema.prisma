generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id                Int                @id @default(autoincrement())
  email             String             @unique(map: "User_email_key")
  password          String
  name              String?
  role              Role               @default(TENANT)
  phone             String?
  type              String?            @default("Individual")
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt
  documents         Document[]
  insurances        Insurance[]
  invoices          Invoice[]
  leases            Lease[]            @relation("TenantLeases")
  receivedMessages  Message[]          @relation("ReceivedMessages")
  sentMessages      Message[]          @relation("SentMessages")
  properties        Property[]         @relation("OwnerProperties")
  refreshTokens     RefreshToken[]
  refundAdjustments RefundAdjustment[]
  tickets           Ticket[]

  @@map("user")
}

model RefreshToken {
  id        Int      @id @default(autoincrement())
  token     String   @unique(map: "RefreshToken_token_key")
  userId    Int
  expiresAt DateTime
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], map: "RefreshToken_userId_fkey")

  @@index([userId], map: "RefreshToken_userId_fkey")
  @@map("refreshtoken")
}

model Property {
  id               Int               @id @default(autoincrement())
  name             String
  address          String
  status           String            @default("Active")
  ownerId          Int?
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  maintenanceTasks MaintenanceTask[]
  owner            User?             @relation("OwnerProperties", fields: [ownerId], references: [id], map: "Property_ownerId_fkey")
  units            Unit[]

  @@index([ownerId], map: "Property_ownerId_fkey")
  @@map("property")
}

model Unit {
  id                Int                @id @default(autoincrement())
  name              String
  propertyId        Int
  status            String             @default("Vacant")
  bedrooms          Int                @default(1)
  rentAmount        Decimal            @default(0.000000000000000000000000000000)
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt
  rentalMode        RentalMode         @default(FULL_UNIT)
  invoices          Invoice[]
  leases            Lease[]
  refundAdjustments RefundAdjustment[]
  property          Property           @relation(fields: [propertyId], references: [id], map: "Unit_propertyId_fkey")

  @@index([propertyId], map: "Unit_propertyId_fkey")
  @@map("unit")
}

model Lease {
  id              Int       @id @default(autoincrement())
  unitId          Int
  tenantId        Int
  startDate       DateTime?
  endDate         DateTime?
  status          String    @default("Active")
  monthlyRent     Decimal?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  securityDeposit Decimal?
  tenant          User      @relation("TenantLeases", fields: [tenantId], references: [id], map: "Lease_tenantId_fkey")
  unit            Unit      @relation(fields: [unitId], references: [id], map: "Lease_unitId_fkey")

  @@index([tenantId], map: "Lease_tenantId_fkey")
  @@index([unitId], map: "Lease_unitId_fkey")
  @@map("lease")
}

model Insurance {
  id           Int      @id @default(autoincrement())
  userId       Int
  provider     String
  policyNumber String
  startDate    DateTime
  endDate      DateTime
  documentUrl  String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  user         User     @relation(fields: [userId], references: [id], map: "Insurance_userId_fkey")

  @@index([userId], map: "Insurance_userId_fkey")
  @@map("insurance")
}

model Document {
  id         Int       @id @default(autoincrement())
  userId     Int
  name       String
  type       String
  expiryDate DateTime?
  fileUrl    String?
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  user       User      @relation(fields: [userId], references: [id], map: "Document_userId_fkey")

  @@index([userId], map: "Document_userId_fkey")
  @@map("document")
}

model Ticket {
  id             Int      @id @default(autoincrement())
  userId         Int
  subject        String
  description    String
  priority       String   @default("Low")
  status         String   @default("Open")
  category       String?
  attachmentUrls String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  propertyId     Int?
  unitId         Int?
  user           User     @relation(fields: [userId], references: [id], map: "Ticket_userId_fkey")

  @@index([userId], map: "Ticket_userId_fkey")
  @@map("ticket")
}

model Invoice {
  id            Int       @id @default(autoincrement())
  invoiceNo     String    @unique(map: "Invoice_invoiceNo_key")
  tenantId      Int
  unitId        Int
  month         String
  amount        Decimal // Total amount expected
  rent          Decimal
  serviceFees   Decimal   @default(0)
  paidAmount    Decimal   @default(0)
  balanceDue    Decimal   @default(0)
  status        String    @default("draft") // draft, sent, partial, paid, overdue, void
  paidAt        DateTime?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  dueDate       DateTime?
  paymentMethod String?
  tenant        User      @relation(fields: [tenantId], references: [id], map: "Invoice_tenantId_fkey")
  unit          Unit      @relation(fields: [unitId], references: [id], map: "Invoice_unitId_fkey")
  payments      Payment[]
  transactions  Transaction[]

  @@index([tenantId], map: "Invoice_tenantId_fkey")
  @@index([unitId], map: "Invoice_unitId_fkey")
  @@map("invoice")
}

model Payment {
  id            Int         @id @default(autoincrement())
  invoiceId     Int
  amount        Decimal
  method        String      // Card, Bank, Cash, etc.
  reference     String?     // Transaction reference
  date          DateTime    @default(now())
  invoice       Invoice     @relation(fields: [invoiceId], references: [id])
  transactions  Transaction[]

  @@map("payment")
}

model MaintenanceTask {
  id         Int       @id @default(autoincrement())
  name       String
  propertyId Int?
  type       String
  frequency  String
  dueDate    DateTime
  vendor     String
  status     String    @default("Upcoming")
  notes      String?
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  property   Property? @relation(fields: [propertyId], references: [id], map: "MaintenanceTask_propertyId_fkey")

  @@index([propertyId], map: "MaintenanceTask_propertyId_fkey")
  @@map("maintenancetask")
}

model Transaction {
  id          Int      @id @default(autoincrement())
  date        DateTime
  description String
  type        String   // Income, Expense, Liability, Asset
  amount      Decimal
  balance     Decimal  @default(0)
  status      String?
  accountId   Int?
  invoiceId   Int?
  paymentId   Int?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  account     Account? @relation(fields: [accountId], references: [id])
  invoice     Invoice? @relation(fields: [invoiceId], references: [id])
  payment     Payment? @relation(fields: [paymentId], references: [id])

  @@map("transaction")
}

model Communication {
  id        Int      @id @default(autoincrement())
  type      String
  recipient String
  subject   String?
  message   String
  status    String   @default("Sent")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("communication")
}

model Message {
  id         Int      @id @default(autoincrement())
  content    String   @db.Text
  senderId   Int
  receiverId Int
  isRead     Boolean  @default(false)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  receiver   User     @relation("ReceivedMessages", fields: [receiverId], references: [id], map: "Message_receiverId_fkey")
  sender     User     @relation("SentMessages", fields: [senderId], references: [id], map: "Message_senderId_fkey")

  @@index([receiverId], map: "Message_receiverId_fkey")
  @@index([senderId], map: "Message_senderId_fkey")
  @@map("message")
}

model SystemSetting {
  id        Int      @id @default(autoincrement())
  key       String   @unique(map: "SystemSetting_key_key")
  value     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("systemsetting")
}

model Tax {
  id        Int       @id @default(autoincrement())
  name      String
  rate      Decimal   @default(0.00) @db.Decimal(10, 2)
  appliesTo String    @default("Rent") @db.VarChar(50)
  status    TaxStatus @default(active)
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  @@map("taxes")
}

model Account {
  id             Int           @id @default(autoincrement())
  accountName    String
  assetType      String
  openingBalance Decimal       @default(0.00) @db.Decimal(10, 2)
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  transactions   Transaction[]

  @@map("accounts")
}

model RefundAdjustment {
  id        Int      @id @default(autoincrement())
  requestId String   @unique(map: "RefundAdjustment_requestId_key")
  type      String
  reason    String
  tenantId  Int
  unitId    Int
  amount    Decimal
  date      DateTime
  status    String   @default("Pending")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  tenant    User     @relation(fields: [tenantId], references: [id], map: "RefundAdjustment_tenantId_fkey")
  unit      Unit     @relation(fields: [unitId], references: [id], map: "RefundAdjustment_unitId_fkey")

  @@index([tenantId], map: "RefundAdjustment_tenantId_fkey")
  @@index([unitId], map: "RefundAdjustment_unitId_fkey")
  @@map("refundadjustment")
}

enum Role {
  ADMIN
  OWNER
  TENANT
}

enum RentalMode {
  FULL_UNIT
  BEDROOM_WISE
}

enum TaxStatus {
  active
  inactive
}
